<!-- HTML generated using hilite.me --><div style="background: #202020; overflow:auto;width:auto;padding:.2em .6em;"><pre style="background: #202020; margin: 0; line-height: 125%">
<span style="color: #6ab825; font-weight: bold">function</span> <span style="color: #447fcf">filemtime_remote</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
	<span style="color: #40ffff">$uri</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">parse_url</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;port&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;port&#39;</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">?</span> <span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;port&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">:</span> <span style="color: #3677a9">80</span><span style="color: #d0d0d0">;</span>
	<span style="color: #40ffff">$handle</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">@</span><span style="color: #24909d">fsockopen</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;host&#39;</span><span style="color: #d0d0d0">],</span> <span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;port&#39;</span><span style="color: #d0d0d0">]);</span>
	<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(!</span> <span style="color: #40ffff">$handle</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span>
	<span style="color: #24909d">fputs</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$handle</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&quot;HEAD $uri[path] HTTP/1.1\r\nHost: $uri[host]\r\n\r\n&quot;</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$result</span> <span style="color: #d0d0d0">=</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">;</span>
	<span style="color: #6ab825; font-weight: bold">while</span><span style="color: #d0d0d0">(!</span> <span style="color: #24909d">feof</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$handle</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$line</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">fgets</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$handle</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">1024</span><span style="color: #d0d0d0">);</span>
		<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(!</span> <span style="color: #d0d0d0">trim(</span><span style="color: #40ffff">$line</span><span style="color: #d0d0d0">))</span> <span style="color: #6ab825; font-weight: bold">break</span><span style="color: #d0d0d0">;</span>
		<span style="color: #40ffff">$col</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">strpos</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$line</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;:&#39;</span><span style="color: #d0d0d0">);</span>
		<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$col</span> <span style="color: #d0d0d0">!==</span> <span style="color: #6ab825; font-weight: bold">false</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$header</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">trim(substr(</span><span style="color: #40ffff">$line</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$col</span><span style="color: #d0d0d0">));</span>
			<span style="color: #40ffff">$value</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">trim(substr(</span><span style="color: #40ffff">$line</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$col</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">));</span>
			<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(strtolower(</span><span style="color: #40ffff">$header</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;last-modified&#39;</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$result</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">strtotime</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$value</span><span style="color: #d0d0d0">);</span>
				<span style="color: #6ab825; font-weight: bold">break</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span>
		<span style="color: #d0d0d0">}</span>
	<span style="color: #d0d0d0">}</span>
	<span style="color: #24909d">fclose</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$handle</span><span style="color: #d0d0d0">);</span>
	<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #40ffff">$result</span><span style="color: #d0d0d0">;</span>
<span style="color: #d0d0d0">}</span>
<span style="color: #999999; font-style: italic">// $b sets a max dimension for the larger of either width or height.  $w is max width. $h is max height.</span>
<span style="color: #6ab825; font-weight: bold">function</span> <span style="color: #447fcf">imageResize</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$b</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">null</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$h</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">null</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$w</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">null</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$prefix</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;{default prefix-,}&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$suffix</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&quot;{-suffix1.*,-suffix2.*,.*}&quot;</span><span style="color: #d0d0d0">){</span>

	<span style="color: #40ffff">$GENERATE_CACHE</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">;</span>	<span style="color: #999999; font-style: italic">// if true, generates caches of the thumbnailed images</span>
	<span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$_SERVER</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;DOCUMENT_ROOT&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;/tmp/imagethumbs/&#39;</span><span style="color: #d0d0d0">;</span>	<span style="color: #999999; font-style: italic">// the full path where thumbnails should be saved (if $GENERATE_CACHE is enabled)</span>
	<span style="color: #40ffff">$BROKEN_IMAGE_PATH</span> <span style="color: #d0d0d0">=</span> <span style="color: #ed9d13">&#39;no-image.png&#39;</span><span style="color: #d0d0d0">;</span>	<span style="color: #999999; font-style: italic">// the full path to the image to be shown when a non-valid image is required or found</span>
	<span style="color: #40ffff">$BASE_HREF</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$_SERVER</span><span style="color: #d0d0d0">[</span><span style="color: #ed9d13">&#39;DOCUMENT_ROOT&#39;</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;/resources/images/&#39;</span><span style="color: #d0d0d0">;</span>	<span style="color: #999999; font-style: italic">// the path string to prepend to every image requested (except external resources, if they are allowed)</span>
	<span style="color: #40ffff">$ALLOW_HTTP_IMAGES</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">false</span><span style="color: #d0d0d0">;</span>	<span style="color: #999999; font-style: italic">// allow requests of http:// or ftp:// resources? Make sure that in php.ini &quot;allow_url_fopen&quot; is set to &quot;true&quot;</span>

	<span style="color: #d0d0d0">filemtime_remote(</span><span style="color: #40ffff">$uri</span><span style="color: #d0d0d0">);</span>

	<span style="color: #999999; font-style: italic">// if not a static path to an image find image in default path</span>
	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(!</span> <span style="color: #24909d">eregi</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^http://&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">!</span> <span style="color: #24909d">eregi</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^ftp://&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$image</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$filename</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">glob</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$BASE_HREF</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$prefix</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&quot;{&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$image</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&quot;}&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$suffix</span><span style="color: #d0d0d0">,GLOB_BRACE);</span>
		    <span style="color: #40ffff">$image</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$filename</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
		<span style="color: #999999; font-style: italic">// if image cannot be located default to &quot;no-image&quot; file</span>
		<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #6ab825; font-weight: bold">empty</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$filename</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]))</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$image</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$BASE_HREF</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$BROKEN_IMAGE_PATH</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span>
	<span style="color: #d0d0d0">}</span>

	<span style="color: #40ffff">$src_size</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">getimagesize</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">);</span>
	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$w</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">ereg</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^[0-9]+$&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$w</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$w</span><span style="color: #d0d0d0">;</span>
	<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
	<span style="color: #d0d0d0">}</span>
	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$h</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">ereg</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^[0-9]+$&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$h</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$MAX_HEIGHT</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$h</span><span style="color: #d0d0d0">;</span>
	<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$MAX_HEIGHT</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">];</span>
	<span style="color: #d0d0d0">}</span>
	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$b</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">ereg</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^[0-9]+$&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$b</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$MAX_BOTH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$b</span><span style="color: #d0d0d0">;</span>
	<span style="color: #d0d0d0">}</span>

	<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$b</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">ereg</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^[0-9]+$&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$b</span><span style="color: #d0d0d0">)){</span>
		<span style="color: #40ffff">$MAX_HEIGHT</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_BOTH</span><span style="color: #d0d0d0">;</span>
		<span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
	<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(</span><span style="color: #24909d">isset</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$b</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #24909d">ereg</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^[0-9]+$&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$b</span><span style="color: #d0d0d0">)){</span>
		<span style="color: #40ffff">$MAX_HEIGHT</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">];</span>
		<span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_BOTH</span><span style="color: #d0d0d0">;</span>
	<span style="color: #d0d0d0">}</span>

	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(!</span> <span style="color: #40ffff">$ALLOW_HTTP_IMAGES</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">eregi</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^http://&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">||</span> <span style="color: #24909d">eregi</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&quot;^ftp://&quot;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)))</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #40ffff">$data</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">readfile</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$BROKEN_IMAGE_PATH</span><span style="color: #d0d0d0">);</span>
		<span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefromstring(</span><span style="color: #40ffff">$data</span><span style="color: #d0d0d0">);</span>
		<span style="color: #d0d0d0">header(</span><span style="color: #ed9d13">&#39;Content-type: image/jpeg&#39;</span><span style="color: #d0d0d0">);</span>
		<span style="color: #d0d0d0">imagejpeg(</span><span style="color: #40ffff">$dest</span><span style="color: #d0d0d0">);</span>
		<span style="color: #24909d">ob_end_flush</span><span style="color: #d0d0d0">();</span>
		<span style="color: #6ab825; font-weight: bold">exit</span><span style="color: #d0d0d0">();</span>
	<span style="color: #d0d0d0">}</span>

	<span style="color: #999999; font-style: italic">// for creating md5 thumbnail file that will update when file is changed</span>
	<span style="color: #40ffff">$full_url</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">str_replace</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;http://&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$image</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$full_url</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">filemtime_remote(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;_&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;_&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$MAX_HEIGHT</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;_&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$full_url</span><span style="color: #d0d0d0">;</span>

	<span style="color: #40ffff">$ext</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">strtolower(substr(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">,</span> <span style="color: #24909d">strrpos</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;.&#39;</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">+</span> <span style="color: #3677a9">1</span><span style="color: #d0d0d0">));</span>

	<span style="color: #40ffff">$thumb_file</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">md5</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$full_url</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">.</span> <span style="color: #ed9d13">&#39;_&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #24909d">basename</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$png_thumb_file</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">str_replace</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;.&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$ext</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;.png&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$thumb_file</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$gif_thumb_file</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">str_replace</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;.&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$ext</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;.gif&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$thumb_file</span><span style="color: #d0d0d0">);</span>
	<span style="color: #40ffff">$jpg_thumb_file</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">str_replace</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;.&#39;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$ext</span><span style="color: #d0d0d0">,</span> <span style="color: #ed9d13">&#39;.jpg&#39;</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$thumb_file</span><span style="color: #d0d0d0">);</span>



	<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">((!</span> <span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span>
		   <span style="color: #d0d0d0">!</span> <span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">&amp;&amp;</span>
		   <span style="color: #d0d0d0">!</span> <span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">)))</span> <span style="color: #d0d0d0">{</span>

		<span style="color: #999999; font-style: italic">// resize the image (if needed)</span>
		<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$MAX_WIDTH</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">])</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">;</span>
				<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">*</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">/</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
			<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">*</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">/</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">];</span>
				<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">;</span>
			<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">*</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">/</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">&gt;</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">]</span> <span style="color: #d0d0d0">*</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">/</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">];</span>
			<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">];</span>
			<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">];</span>
		<span style="color: #d0d0d0">}</span>

		<span style="color: #999999; font-style: italic">// force resizing in both dimensions</span>
		<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$w</span> <span style="color: #d0d0d0">!=</span> <span style="color: #6ab825; font-weight: bold">null</span> <span style="color: #d0d0d0">&amp;&amp;</span>  <span style="color: #40ffff">$h</span> <span style="color: #d0d0d0">!=</span> <span style="color: #6ab825; font-weight: bold">null</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #40ffff">$dest_width</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_WIDTH</span><span style="color: #d0d0d0">;</span>
			<span style="color: #40ffff">$dest_height</span> <span style="color: #d0d0d0">=</span> <span style="color: #40ffff">$MAX_HEIGHT</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span>

		<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">extension_loaded</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;gd&#39;</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>

			<span style="color: #999999; font-style: italic">// check the source file format</span>
			<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$ext</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;jpg&#39;</span> <span style="color: #d0d0d0">||</span> <span style="color: #40ffff">$ext</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;jpeg&#39;</span><span style="color: #d0d0d0">){</span>
				<span style="color: #40ffff">$src</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefromjpeg(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #40ffff">$failed</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$ext</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;gif&#39;</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$src</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefromgif(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #40ffff">$failed</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">elseif</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$ext</span> <span style="color: #d0d0d0">==</span> <span style="color: #ed9d13">&#39;png&#39;</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$src</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefrompng(</span><span style="color: #40ffff">$image</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #40ffff">$failed</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$failed</span> <span style="color: #d0d0d0">=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span>

			<span style="color: #6ab825; font-weight: bold">if</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$failed</span> <span style="color: #d0d0d0">!=</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #999999; font-style: italic">// create and output the destination image</span>
				<span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatetruecolor(</span><span style="color: #40ffff">$dest_width</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$dest_height</span><span style="color: #d0d0d0">)</span> <span style="color: #6ab825; font-weight: bold">or</span> <span style="color: #6ab825; font-weight: bold">die</span><span style="color: #d0d0d0">(</span><span style="color: #ed9d13">&#39;Cannot initialize new GD image stream&#39;</span><span style="color: #d0d0d0">);</span>
				<span style="color: #d0d0d0">imagecolortransparent(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #d0d0d0">imagecolorallocatealpha(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">127</span><span style="color: #d0d0d0">));</span>
				<span style="color: #d0d0d0">imagealphablending(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">false</span><span style="color: #d0d0d0">);</span>
				<span style="color: #d0d0d0">imagesavealpha(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #6ab825; font-weight: bold">true</span><span style="color: #d0d0d0">);</span>
				<span style="color: #d0d0d0">imagecopyresampled(</span><span style="color: #40ffff">$dest</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$src</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #3677a9">0</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$dest_width</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$dest_height</span><span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">0</span><span style="color: #d0d0d0">],</span> <span style="color: #40ffff">$src_size</span><span style="color: #d0d0d0">[</span><span style="color: #3677a9">1</span><span style="color: #d0d0d0">]);</span>

				<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(imagetypes()</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">IMG_PNG)</span> <span style="color: #d0d0d0">{</span>
					<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$GENERATE_CACHE</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">imagepng(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">);</span>
					<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">;</span>
				<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">elseif</span> <span style="color: #d0d0d0">(imagetypes()</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">IMG_JPG)</span> <span style="color: #d0d0d0">{</span>
					<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$GENERATE_CACHE</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">imagejpeg(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">);</span>
					<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">;</span>
				<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(imagetypes()</span> <span style="color: #d0d0d0">&amp;&amp;</span> <span style="color: #d0d0d0">IMG_GIF)</span> <span style="color: #d0d0d0">{</span>
					<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #40ffff">$GENERATE_CACHE</span><span style="color: #d0d0d0">)</span> <span style="color: #d0d0d0">imagegif(</span><span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">,</span> <span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">);</span>
					<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">;</span>
				<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
					<span style="color: #40ffff">$data</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">readfile</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$BROKEN_IMAGE_PATH</span><span style="color: #d0d0d0">);</span>
					<span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefromstring(</span><span style="color: #40ffff">$data</span><span style="color: #d0d0d0">);</span>
					<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #40ffff">$dest</span><span style="color: #d0d0d0">;</span>
				<span style="color: #d0d0d0">}</span>
			<span style="color: #d0d0d0">}</span>
			<span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
				<span style="color: #40ffff">$data</span> <span style="color: #d0d0d0">=</span> <span style="color: #24909d">readfile</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$BROKEN_IMAGE_PATH</span><span style="color: #d0d0d0">);</span>
				<span style="color: #40ffff">$dest</span> <span style="color: #d0d0d0">=</span> <span style="color: #d0d0d0">imagecreatefromstring(</span><span style="color: #40ffff">$data</span><span style="color: #d0d0d0">);</span>
				<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #40ffff">$dest</span><span style="color: #d0d0d0">;</span>
			<span style="color: #d0d0d0">}</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #6ab825; font-weight: bold">print</span> <span style="color: #ed9d13">&#39;GD-library support is not available&#39;</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span>
	<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
		<span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #24909d">touch</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">);</span>
			<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$png_thumb_file</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #24909d">touch</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">);</span>
			<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$jpg_thumb_file</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #6ab825; font-weight: bold">if</span> <span style="color: #d0d0d0">(</span><span style="color: #24909d">file_exists</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">))</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #24909d">touch</span><span style="color: #d0d0d0">(</span><span style="color: #40ffff">$CACHE_PATH</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">);</span>
			<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #ed9d13">&quot;/tmp/imagethumbs/&quot;</span> <span style="color: #d0d0d0">.</span> <span style="color: #40ffff">$gif_thumb_file</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span> <span style="color: #6ab825; font-weight: bold">else</span> <span style="color: #d0d0d0">{</span>
			<span style="color: #6ab825; font-weight: bold">return</span> <span style="color: #40ffff">$BROKEN_IMAGE_PATH</span><span style="color: #d0d0d0">;</span>
		<span style="color: #d0d0d0">}</span>
	<span style="color: #d0d0d0">}</span>
<span style="color: #d0d0d0">}</span>
</pre></div>
